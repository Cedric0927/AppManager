# AppManager 桌面应用设计文档

## 1. 需求概述
### 1.1 目标
打造一款小巧、精致的 Windows 桌面工具，自动分析并可视化展示电脑上“正规渠道安装软件”的实际空间占用，重点解决 C 盘空间被应用数据（AppData/ProgramData）暗中吃掉的问题。

### 1.2 核心功能
- **软件清单识别**：从系统注册表和 UWP 应用商店获取已安装软件列表。
- **深度空间归因**：不只计算安装目录，还需通过智能匹配算法关联其在 `AppData` 和 `ProgramData` 下的存储目录。
- **可视化列表**：像手机存储管理一样，按占用大小排序，支持搜索和查看明细。
- **极速扫描**：利用 Rust 的并发能力，在数秒内完成 C 盘几十万个文件的扫描与统计。

---

## 2. 技术选型
- **框架**: [Tauri](https://tauri.app/) (v2)
- **后端 (Core)**: Rust
  - `jwalk`: 高性能并发目录遍历。
  - `sysinfo` / `winreg`: 获取系统信息与注册表操作。
  - `serde`: 数据序列化。
- **前端 (UI)**: React + TypeScript
  - `Tailwind CSS`: 实现精致、现代化的 UI。
  - `Lucide React`: 图标库。
  - `Framer Motion`: 实现流畅的动效。

---

## 3. 架构设计
### 3.1 数据归因逻辑 (Key Logic)
软件占用空间 = **安装目录 (InstallLocation)** + **用户数据目录 (AppData)** + **机器数据目录 (ProgramData)**。
- **匹配规则**：
  1. **直接路径**：读取注册表中的 `InstallLocation`。
  2. **模糊匹配**：将软件的 `DisplayName` 或 `Publisher` 与 `AppData/Local` 下的文件夹名进行相似度匹配。
  3. **已知规则库**：内置常见软件（如微信、Chrome、Adobe 系列）的特殊路径规则。

### 3.2 扫描流程
1. **获取清单**：Rust 调用 WinAPI 读取注册表卸载清单。
2. **构建索引**：预扫描 C 盘关键数据目录（AppData/ProgramData），建立“文件夹名 -> 大小”的缓存映射。
3. **关联计算**：将软件条目与文件夹索引进行关联。
4. **前端展示**：通过 Tauri Command 将结构化数据流式传回前端。

---

## 4. 界面信息架构
- **概览栏**：展示 C 盘总占用、剩余空间。
- **软件列表**：
  - 图标 | 软件名称 | 厂商
  - 占用条 (百分比)
  - 占用大小 (GB/MB)
- **详情弹窗**：展示具体的路径构成（安装路径、缓存路径、数据路径）。

---

## 5. 开发路线图 (Roadmap)
- **Phase 1**: 环境配置与项目初始化。
- **Phase 2**: 实现 Rust 端基础扫描引擎（注册表读取 + 目录遍历）。
- **Phase 3**: 实现归因算法（将软件与 AppData 文件夹绑定）。
- **Phase 4**: 前端 UI 开发与数据交互。
- **Phase 5**: 性能优化与兼容性测试。
